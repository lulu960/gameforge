{% extends "base.html" %}
{% block content %}
<div class="grid lg:grid-cols-3 gap-6">
  <div class="lg:col-span-2 space-y-4">
    <div class="rounded border border-white/10 bg-gray-900/60 overflow-hidden">
      {% if game.environment_image_url %}
        <img src="{{ game.environment_image_url }}" class="w-full h-56 object-cover" alt="env">
      {% endif %}
      <div class="p-4 space-y-2">
        <h1 class="text-3xl font-bold">{{ game.title }}</h1>
        <p class="text-sm text-gray-400">Genre: {{ game.get_genre_display }} • {{ game.ambiance }} • par {{ game.user.username }}</p>
        <pre class="whitespace-pre-wrap text-sm text-gray-200">{{ game.universe }}</pre>
        <pre class="whitespace-pre-wrap text-sm text-gray-200">{{ game.locations }}</pre>
        <h2 class="text-xl font-semibold mt-3">Scénario</h2>
        <pre class="whitespace-pre-wrap text-sm text-gray-200">{{ game.story }}</pre>
      </div>
    </div>

    <div class="rounded border border-white/10 bg-gray-900/60 p-4">
      <h2 class="text-xl font-semibold mb-2">Personnages</h2>
      <div class="grid md:grid-cols-2 gap-3">
        {% for ch in game.characters.all %}
        <div class="border border-white/10 rounded p-3 bg-gray-900/60">
          <div class="font-semibold">{{ ch.name }}</div>
          <div class="text-xs text-gray-400 mb-1">{{ ch.role }}</div>
          <p class="text-sm">{{ ch.abilities }}</p>
          <p class="text-sm text-gray-300">{{ ch.motivation }}</p>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <aside class="space-y-4">
    <div class="rounded border border-white/10 bg-gray-900/60 overflow-hidden">
      {% if game.character_image_url %}
        <img src="{{ game.character_image_url }}" class="w-full h-56 object-cover" alt="character">
      {% endif %}
      <div class="p-4 space-y-3">
        {% if user.is_authenticated %}
          {% if is_favorite %}
            <a href="{% url 'games:unfavorite' game.id %}" class="block text-center px-3 py-2 rounded bg-gray-800 hover:bg-gray-700">Retirer des favoris</a>
          {% else %}
            <a href="{% url 'games:favorite' game.id %}" class="block text-center px-3 py-2 rounded bg-amber-700 hover:bg-amber-600">Ajouter aux favoris ⭐</a>
          {% endif %}
          {% if user == game.user %}
            <a href="{% url 'games:toggle_privacy' game.id %}" class="block text-center px-3 py-2 rounded bg-indigo-700 hover:bg-indigo-600">
              Rendre {{ game.is_public|yesno:"privé,public" }}
            </a>
          {% endif %}
        {% else %}
          <p class="text-sm text-gray-400">Connectez-vous pour ajouter aux favoris.</p>
        {% endif %}
      </div>
    </div>
  </aside>
{% endblock %}
